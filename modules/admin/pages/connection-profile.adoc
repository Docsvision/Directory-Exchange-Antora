= Создание профиля подключения

Для подключения к БД и серверу {dv} _Сервис репликации справочников_ использует настройки из _Профиля подключения_. В одном профиле подключения указываются данные подключения только к одной БД сервера {dv}: если используется несколько БД -- нужно будет создать Профиль подключения для каждой из них.

.Чтобы создать профиль подключения:
. Запустите программу "Консоль настроек репликации справочников {dv}" из меню Пуск от имени локального администратора. При первом запуске будет предложено создать новый профиль подключения.
+
.Создание нового профиля подключения
image::new-profile.png[Создание нового профиля подключения]
+
[NOTE]
====
Общие настройки программы хранятся в реестре ОС.
====
+
. Введите название профиля, например, `Standard`, и нажмите *ОК*. Будет открыто окно настройки подключения.
+
.Редактирование профиля подключения
image::edit-connection-profile.png[Редактирование профиля подключения]
+
. Заполните параметры в разделе "Параметры учетной записи сервиса":
+
* Учётная запись -- учётная запись, от имени которой будет запускаться _Сервис репликации справочников_.
+
.Может быть выбран один из предложенных вариантов:
** *_LocalSystem_* -- использовать уч. запись _LocalSystem_;
** *_LocalService_* -- использовать уч. запись _LocalService_;
** *_NetworkService_* -- использовать уч. запись _NetworkService_;
** *_User_* -- использовать указанную учётную запись.
* В полях _Имя пользователя_ и _Пароль_ введите данные учётной записи, если в настройке _Учётная запись_ выбран вариант `User`.
+
После установки "Сервиса репликации справочников" с данным профилем подключения изменить учётную запись сервиса можно будет в настройках данной службы Windows, см. xref:install-replication-service.adoc[Установка Сервиса репликации справочников]
+
. Заполните _Параметры подключения к {dv}_ в соответствующем разделе:
+
* _Строка подключения_ -- адрес подключения к текущему серверу {dv} в формате `http://Имя-сервера-{dv}/{dv}/StorageServer/StorageServerService.asmx`.
* _База_ -- название БД текущего сервера {dv}, если синхронизируется не БД по умолчанию.
* _Имя пользователя_/_Пароль_ -- данные учетной записи, от имени которой будет выполняться подключение к серверу {dv}.
+
Учетная запись, от имени которой выполняется подключение, должна обладать правами администратора {dv}.
+
. Нажмите кнопку *Проверить подключение* для проверки введённых данных.
. Заполните _Параметры подключения к базе {dv}_ в соответствующем разделе:
+
* _Сервер_ -- сетевое имя сервера с БД текущего сервера {dv}, указанного в разделе "Параметры подключения к {dv}".
* _Имя базы_ -- название БД {dv}. Должно соответствовать БД, указанной в разделе "Параметры подключения к {dv}" -- для БД по умолчанию нужно указать фактическое название БД.
* `*Использовать текущую учетную запись*` -- установите флаг, если для подключения к БД должна использоваться аутентификация Windows вместо SQL-аутентификации.
+
[#above]
.Обратите внимание:
****
Подключение к БД из программы _Консоль настроек репликации справочников {dv}_ будет выполнено от имени пользователя, запустившего программу, а при работе _Сервиса репликации справочников_ будет использоваться учётная запись сервиса, указанная в разделе _Параметры учетной записи сервиса_.
****
+
* Если флаг `*Использовать текущую учетную запись*` снят, в полях _Имя пользователя_/_Пароль_ укажите данные учётной записи, от имени которой будет выполняться подключение к БД {dv}.
+
Учетная запись, от имени которой выполняется подключение, должна обладать правами `dbo` на БД.
+
. Нажмите кнопку *Проверить подключение* для проверки введённых данных.
+
. Заполните параметры в разделе _Параметры подключения к базе журнала_ базы с настройками и оперативными данными _Модуля репликации справочников_:
+
* _Сервер_ -- сетевое имя сервера с БД.
* _Имя базы_ -- название БД журнала синхронизации.
* _Использовать текущую учетную запись_ -- использовать аутентификация Windows для подключения к БД.
+
Особенности использования текущей учётной записи для подключения к БД <<above,см. выше>>.
+
* Если флаг `*Использовать текущую учетную запись*` снят, в полях _Имя пользователя_/_Пароль_ укажите данные учётной записи, от имени которой будет выполняться подключение к БД.
* Установите флаг `*Создать базу в случае её отсутствия*`, чтобы БД журнала синхронизации была создана автоматически при первом подключении.
+
Учетная запись, от имени которой выполняется подключение, должна обладать правами `dbo` на БД. Для создания новой БД нужны права `dbcreator`.
+
. Нажмите кнопку *Проверить подключение* для проверки введённых данных. Если БД отсутствует и установлен флаг `*Создать базу в случае её отсутствия*` -- БД будет создана.
. Заполните параметры в разделе _Параметры переподключения к удалённому серверу_.
+
Если в момент фоновой синхронизации производится обрыв соединения с удаленным сервером, то Сервис репликации пытается повторно подключиться к удаленному серверу через интервал, указанной в поле _Интервал между попытками (мс)_. Количество попыток переподключения указывается в поле _Количество попыток переподключения_.
+
Параметры в данном разделе следует устанавливать таким образом, чтобы общее время попыток переподключения не превышало интервал между синхронизациями, указанный в расписании обмена, а также время жизни сессии, указанное в _Консоли настройки {dv}_ для текущего сервера.
+
.Пример профиля подключения
image::profile.png[Пример профиля подключения]
+
Если текущий сервер {dv} работает с несколькими БД, для работы с каждой из них нужно создать отдельный профиль, см. раздел "xref:new-profile.adoc[Создание нового профиля подключения]".
